<mat-sidenav-container class="sidenav-container" (backdropClick)="sideNavClose()">
    <mat-sidenav #sidenav mode="over" autoFocus="false" class="sideNav-style">
        <mat-card class="sideNav-card">
            <mat-card-header>
                <div mat-card-avatar class="sideNav-header-image"></div>
                <mat-card-title>{{currentUser.nickName}}</mat-card-title>
                <mat-card-subtitle>{{currentUser.motto}}</mat-card-subtitle>
            </mat-card-header>
        </mat-card>

        <mat-nav-list>
            <a mat-list-item [routerLink]="['/user_profile']">
                <mat-icon svgIcon="user_profile"> </mat-icon>
                User Profile
            </a>
            <a mat-list-item [routerLink]="['/data_sync']">
                <mat-icon svgIcon="data_backup"> </mat-icon>
                Data Synchronization
            </a>
        </mat-nav-list>

        <footer class="footer">
            <div class="button-row">
                <button mat-flat-button color="warn" (click)="logout()">LogOut</button>
                <button mat-flat-button color="primary" (click)="connectUs()">Contact US</button>
            </div>
        </footer>
    </mat-sidenav>
    <mat-sidenav-content>
        <mat-toolbar>
            <span>
                <img src="assets/img/125495334_31n.jpg" class="img-profile" (click)="sidenav.open()"/>
            </span>
            <span class="toolbar-fill-remaining-space"></span>
            <span>
                <button color="primary" mat-raised-button (click)="openDialog()">New</button>
            </span>
        </mat-toolbar>
        <mat-tab-group selectedIndex={{selectedIndex}}>
            <mat-tab label="Backlog">
                <mat-accordion>
                    <!--ng-template *ngFor="let task of submittedTasks" -->
                    <div *ngFor="let task of submitTaskForms; index as taskIndex;">
                    <form [formGroup]="task" >
                        <mat-expansion-panel>
                            <mat-expansion-panel-header>
                                <mat-panel-title>
                                    {{task.value.taskType}}
                                </mat-panel-title>
                                <mat-panel-description>
                                    {{task.value.taskName}}
                                </mat-panel-description>
                            </mat-expansion-panel-header>
                            <div class="task-details-container">
                                <input hidden formControlName="taskId">
                                <mat-form-field class="input-full-width">
                                    <input matInput formControlName="taskName" placeholder="Book Name">
                                </mat-form-field>
                                <mat-form-field class="input-full-width">
                                    <input matInput type="number" formControlName="pagesCurrent" placeholder="Current Page">
                                </mat-form-field>
                                <mat-form-field class="input-full-width">
                                    <input matInput type="number" formControlName="pagesIntotal" placeholder="Total Pages">
                                </mat-form-field>
                                <mat-form-field class="input-full-width">
                                    <input matInput type="number" formControlName="expectedDays" placeholder="Expected Days">
                                </mat-form-field>
                                <div class="button-row">
                                    <button mat-raised-button (click)="saveAndStart(task)">Start</button>
                                    <button mat-raised-button (click)="update(task)">Update</button>
                                    <button mat-raised-button (click)="delete(task, taskIndex, 'submitted')">Delete</button>
                                </div>
                            </div>
                        </mat-expansion-panel>
                    </form>
                    
                    </div>
                </mat-accordion>
            </mat-tab>
            <mat-tab label="On-going">
                <mat-accordion>
                    <div *ngFor="let task of ongoingTaskForms; index as taskIndex;">
                    <form [formGroup]="task" >
                        <mat-expansion-panel>
                            <mat-expansion-panel-header>
                                <mat-panel-title>
                                    {{task.value.taskType}}
                                </mat-panel-title>
                                <mat-panel-description>
                                    {{task.value.taskName}}
                                </mat-panel-description>
                            </mat-expansion-panel-header>
                            <div class="task-details-container">
                                <mat-progress-bar mode="determinate" [value]="task.value.progress" class="progress-bar"></mat-progress-bar>
                                <input hidden formControlName="taskId">
                                <input hidden type="number" formControlName="taskStatus">
                                <mat-form-field class="input-full-width">
                                    <mat-select placeholder="Current Page" formControlName="pagesCurrent" (selectionChange)="pageChange($event, taskIndex)">
                                        <mat-option *ngFor="let page of [].constructor(task.value.pagesIntotal); index as i;" [value]="i+1">
                                            {{i+1}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                                <mat-form-field class="input-full-width">
                                    <input matInput type="number" formControlName="pagesIntotal" readonly="true" placeholder="Total Pages">
                                </mat-form-field>
                                <mat-form-field class="input-full-width">
                                    <input matInput formControlName="startTime" readonly="true" placeholder="Start Time">
                                </mat-form-field>
                                <div [chart]="task.value.chartData"></div>
                                <div class="button-row">
                                    <button mat-raised-button (click)="deleteDialog(task, taskIndex, 'on-going')">Delete</button>
                                </div>
                            </div>
                        </mat-expansion-panel>
                    </form>
                    </div>
                </mat-accordion>
            </mat-tab>
            <mat-tab label="Achievement">Tasks have been done</mat-tab>
        </mat-tab-group> 
    </mat-sidenav-content>
</mat-sidenav-container>
